<h2 class="carrito-title">Carrito üíõ</h2>

<!-- LISTA DE PRODUCTOS -->
<div class="carrito-lista">
  <div *ngFor="let p of carritoService.items()" class="carrito-item">
    <img [src]="p.imagen" class="item-img" alt="Producto">

    <div class="info">
      <h4>{{ p.nombre }}</h4>
      <p>${{ p.precio }}</p>
      <p>Cantidad: {{ p.cantidad || 1 }}</p>
    </div>
  </div>
</div>

<button (click)="confirmarCompra()" class="btn-comprar">Comprar</button>


<!-- FORMULARIO PRINCIPAL -->
<div class="modal" *ngIf="mostrarFormulario">
  <div class="modal-content">

    <h3>Completar informaci√≥n</h3>

    <label>Nombre:</label>
    <input type="text" [(ngModel)]="cliente.nombre" required>

    <label>Correo:</label>
    <input type="email" [(ngModel)]="cliente.correo" required>

    <label>Tel√©fono:</label>
    <input type="text" [(ngModel)]="cliente.telefono" required>

    <label>Direcci√≥n:</label>
    <input type="text" [(ngModel)]="cliente.direccion" required>

    <label>Ciudad:</label>
    <input type="text" [(ngModel)]="cliente.ciudad" required>

    <label>Regi√≥n:</label>
    <input type="text" [(ngModel)]="cliente.region" required>

    <label>M√©todo de pago:</label>
    <select [(ngModel)]="cliente.metodo_pago" required>
      <option value="Nequi">Nequi</option>
      <option value="Daviplata">Daviplata</option>
      <option value="Efecty">Efecty</option>
      <option value="Tarjeta de cr√©dito">Tarjeta de cr√©dito</option>
    </select>

    <!-- N√öMERO DE CUENTA (Nequi, Daviplata, Efecty) -->
    <div *ngIf="cliente.metodo_pago !== 'Tarjeta de cr√©dito'">
      <label>N√∫mero de cuenta:</label>
      <input type="text" [(ngModel)]="cliente.numeroCuenta">
    </div>

    <!-- NEQUI / DAVIPLATA -->
    <div *ngIf="cliente.metodo_pago === 'Nequi' || cliente.metodo_pago === 'Daviplata'">
      <label>C√≥digo (5 d√≠gitos):</label>
      <input type="text" maxlength="5" [(ngModel)]="cliente.codigoVerificacion">
    </div>

    <!-- TARJETA -->
    <div *ngIf="cliente.metodo_pago === 'Tarjeta de cr√©dito'">
      <label>N√∫mero de tarjeta (16 d√≠gitos):</label>
      <input type="text" maxlength="16" [(ngModel)]="cliente.numeroTarjeta">

      <label>CVV (3 d√≠gitos):</label>
      <input type="text" maxlength="3" [(ngModel)]="cliente.cvv">
    </div>

    <div class="btns">
      <button (click)="finalizarCompra()">Continuar</button>
      <button class="cancelar" (click)="cerrarFormulario()">Cancelar</button>
    </div>

  </div>
</div>


<!-- FORMULARIO RESUMEN FINAL -->
<div class="modal" *ngIf="mostrarResumen">
  <div class="modal-content">

    <h3>Resumen de la compra</h3>

    <p><b>Factura:</b> #{{ numeroFactura }}</p>
    <p><b>Cliente:</b> {{ cliente.nombre }}</p>
    <p><b>M√©todo de pago:</b> {{ cliente.metodo_pago }}</p>
    <p *ngIf="cliente.numeroCuenta"><b>N√∫mero de cuenta:</b> {{ cliente.numeroCuenta }}</p>

    <h4>Productos:</h4>

    <div *ngFor="let p of carritoService.items()" class="resumen-item">
      <img [src]="p.imagen" class="item-img">
      <span>{{ p.nombre }} (x{{ p.cantidad || 1 }})</span>
      <span>${{ p.precio * (p.cantidad || 1) }}</span>
    </div>

    <h3>Total: ${{ totalPrice() }}</h3>

    <button (click)="confirmarCompraFinal()">Finalizar Compra</button>

  </div>
</div>